all:
	# Build afl++ harness for btcd's script interpreter
	go build -o libbtcdverifyscript.a -buildmode=c-archive verify_script.go
	afl-clang-fast -fsanitize=fuzzer -I./ harness.c libbtcdverifyscript.a -o btcd_harness
	# Build afl++ harness for Bitcoin Core's script interpreter
	AFL_LLVM_LAF_ALL=1 afl-clang-fast -DUSE_BITCOIN_CONSENSUS -I./ harness.c -O0 -c -o libbitcoinconsensus_harness.o
	AFL_LLVM_LAF_ALL=1 afl-clang-fast++ -fsanitize=fuzzer libbitcoinconsensus_harness.o libbitcoinconsensus.a libsecp256k1.a -o libbitcoinconsensus_harness
	# Build libFuzzer harness for Bitcoin Core's script interpreter
	clang -DUSE_BITCOIN_CONSENSUS -DLIBFUZZER -I./ harness.c -fsanitize=fuzzer-no-link -c -o libbitcoinconsensus_harness_libfuzzer.o
	clang++ -fsanitize=fuzzer libbitcoinconsensus_harness_libfuzzer.o libbitcoinconsensus_libfuzzer.a libsecp256k1_libfuzzer.a -o libbitcoinconsensus_harness_libfuzzer

clean:
	rm btcd_harness libbitcoinconsensus_harness.o libbitcoinconsensus_harness libbitcoinconsensus_harness_libfuzzer.o libbitcoinconsensus_harness_libfuzzer
